\section{Identity based crypto}

Asymetrické kryptovacie systémy, ktoré veľmi dobre poznáme, vyžadujú,
aby si každý vygeneroval vlastnú inštanciu danej schémy. Problém pri
takomto riešení je distribúcia verejného kľúča. Ak nemám dostatočne
dôveryhodný kanál na distribúciu môjho verejného kľúča, útočník si
môže pripraviť vlastný kľúč a presvedčiť obeť o tom, že je to môj
kľúč. Navyše, existujú isté ťažkosti s udržiavaním verejných kľúčov a
limity sú aj v chápanlivosti ľudí o potrebe bezpečného kanálu pri
distribúcii.
Isté riešenie tohoto problému,
ktoré sa ujalo najmä pri webových aplikáciach sú certifikáty --
kľúč sa podpíše dôveryhodnou autoritou a každý si môže
overiť, že po kanáli dostal správny kľúč. V tejto kapitole sa budeme
venovať alternatívnemu riešeniu -- verejným kľúčom bude priamo moja
identita.

Ako si to teda môžeme predstaviť? Nebudeme generovať inštanciu schémy,
ale uvažujme rovno, že mojím kľúčom bude priamo moja identifikácia -
či už email, OpenID konto a pod.

Na pomoc si ale budeme musieť prizvať dôveryhodnú tretiu stranu $T$.
Táto strana bude mať 2 kľúče master public key $M_{pk}$ a master
secret key $M_{sk}$. Túto tretiu stranu budeme potrebovať, aby nám
vygenerovala náš súkromný kľúč k môjmu verejnému kľúču (kontu).
Formálne, toto generovanie si môžeme popísať ako algoritmus, ktorý
užívateľovi $U$ priradí na záklede jeho identity $ID_U$ jeho súkromný
kľúč $U_{sk} = Extract(M_{sk}, ID_U)$. Samozrejme, kľúč ešte treba
dôveryhodne doručiť, toto ale nebudeme riešiť.

Potom môžeme šifrovať a dešifrovať nasledovne:
$c=E(m,ID_U,M_{pk})$ a opačne $m = D(c, U_{sk}, M_{pk})$, pričom
samozrejme požadujeme
$\forall ID_U \forall m: D(E(m, ID_U, M_{pk}), Extract(M_{sk},ID_U),
M_{pk})=m$.

Takáto schéma má ale výraznú bezpečnostnú slabinu - kompromitácia
$M_{sk}$ je fatálna. Je teda otázne, do akej miery môžeme dôverovať
zabezpečeniu dôveryhodnej strany. Napriek tomuto problému si ukážeme,
ako môže taká schéma fungovať.

\subsection{Coksova schéma (2001)}

Bezpečnosť Coksovej schémy sa opiera o problém rozlišovania medzi
štvorcami a preudoštvorcami. Presnejšie povedané,
nech $n=pq$ kde $p,q$ sú prvočísla také, že $p \equiv q \equiv 3 \pmod{4}$.

\def\jacobi#1#2{\left( \frac{#1}{#2} \right)}

Nás budú zaujímať také čísla $x$, pre ktoré Jakobiho symbol
$\jacobi{x}{n} =1$. Jakobiho symbol totiž vieme počítať aj bez
faktorizácie $n$, na druhú stranu, overiť, či $x$ je štvorec alebo len
pseudoštvorec je ľahko rozhodnuteľné.

\begin{figure}[h]
    \centering
    \includegraphics{img/9/coks.1.mps}
    \caption{Jakobiho symbol pre $n=pq$}
    \label{fig:jakobi}
\end{figure}


Schéma pre dôveryhodnú tretiu stranu bude nasledovná
\begin{itemize}
    \item $M_{pk}: \langle n \rangle$
    \item $M_{sk}: \langle p,q \rangle$
    \item Extract: $h: \{0,1\}^* \mapsto (QR_n \union QNR_n^{+1})$,
    kde $h$ bude dobrá hashovacia funkcia.
\end{itemize}

Najskôr by sme si mali overiť, že vieme ľahko vytvoriť dobrú
hashovaciu funkciu. Uvažujme $h:\{0,1\}^* \mapsto Z_n$.
Potom túto funkciu vieme veľmi jednoducho transformovať, aby išla do
zúženého definičného oboru nasledovným spôsobom.

Zvoľme si $a \inr n$ také, že $\jacobi{a}{n} = -1$.
\fixme{Naozaj $a$ musi byt nahodne alebo staci fixne?}
Jednoduché pozorovanie je, že ak $\jacobi{h(x)}{n}=-1$,
potom $\jacobi{a h(x)}{n}=1$.
Tým pádom funkcia
\begin{equation*}
h'(x) = \begin{cases}
            h(x)   \quad &\jacobi{h(x)}{n}=1 \\
            a h(x) \quad &\jacobi{h(x)}{n}=-1
        \end{cases}
\end{equation*}
je dobrým kandidátom na hashovaciu funkciu.

Priradenie kľúčov identite bude prebiehať nasledovne:
\begin{itemize}
    \item $U_{pk}=h(ID_U)$

    \item $U_{sk}^2=\begin{cases}
            \phantom{-} U_{pk}\pmod{n}  \quad& U_{pk} \in QR_n \\
                     -  U_{pk}\pmod{n}  \quad& U_{pk} \in QNR_n^{+1}
                    \end{cases}$
\end{itemize}

\noindent
Šifrovanie:
\begin{itemize}
    \item Správa je $m\in\{-1,1\}$
    \item Náhodne zvolíme $t_1,t_2$ tak aby platilo
            $\jacobi{t_1}{n} = \jacobi{t_2}{n} = m$
    \item $y_1 = t_1 + U_{pk} t_1^{-1} \pmod{n}$
    \item $y_2 = t_2 - U_{pk} t_2^{-1} \pmod{n}$.\footnote{
            Pozor -- zmena v znamienku}
    \item $E(m) = \langle y_1, y_2 \rangle$.
\end{itemize}

\noindent
Dešifrovanie:
Budeme rozlišovať 2 prípady.
\begin{itemize}
    \item $U_{sk}^2 \equiv U_{pk}$.
        Vypočítame Jakobiho symbol $\jacobi{y_1 + 2U_{sk}}{n}$.
        \begin{align*}
            \jacobi{y_1 + 2U_{sk}}{n} &=
            \jacobi{t_1 + U_{pk} t_1^{-1} + 2 U_{sk}}{n} =
            \jacobi{t_1 + U_{sk}^2 t_1^{-1} + 2 U_{sk}}{n} \\
            &=
            \jacobi{t_1(1 + U_{sk}^2 t_1^{-1} + 2 t_1{-1} U_{sk})}{n} =
            \jacobi{t_1(1+U_{sk}t_1^{-1})^2}{n}  \\
            &=
            \jacobi{t_1}{n} \cdot \jacobi{(1+U_{sk}t_1^{-1})^2}{n}=
            \jacobi{t_1}{n} \cdot 1 \\
            &= m
        \end{align*}

    \item $U_{sk}^2 \equiv -U_{pk}$.
        Vypočítame Jakobiho symbol $\jacobi{y_2 + 2U_{sk}}{n}$.
        \begin{align*}
            \jacobi{y_2 + 2U_{sk}}{n} &=
            \jacobi{t_2 - U_{pk} t_2^{-1} + 2 U_{sk}}{n} =
            \jacobi{t_2 + U_{sk}^2 t_2^{-1} + 2 U_{sk}}{n} \\
            &=
            \jacobi{t_2(1 + U_{sk}^2 t_2^{-1} + 2 t_2{-1} U_{sk})}{n}
            \\
            &=
            \jacobi{t_2}{n} \cdot \jacobi{(1+U_{sk}t_2^{-1})^2}{n} \\
            &= m
        \end{align*}
\end{itemize}

\subsubsection{Bezpečnosť schémy}
Predpokladajme, že $U_{sk} \equiv U_{pk}$.
Ukážeme, že z pohľadu útočníka nenesie $y_2$ žiadnu informáciu o tom, ako
vyzerá $m$.

Nech $y = t - U_{pk} t^{-1} \pmod{n}$.
$0=t^2 - y t - U_{pk} \pmod{n}$.
$ t^2 - y t - U_{pk} \equiv 0 \pmod{p}$.
Dostali sme kvadratickú rovnicu nad poľom $Z_p$ a teda riešením sú 2 korene
$r_1,r_2$.
$(t-r_1)(t-r_2) =t^2 - y t - U_{pk}$.
$r_1 r_2 \equiv -U_{pk}$.

\fixme{wtf?}

$\jacobi{r_1}{p} \jacobi{r_2}{p} = \jacobi{r_1 r_2}{p} =
\jacobi{-U_{pk}}{p} = \jacobi{-1}{p} \jacobi{U_{sk}^2}{p}=1$.
($\jacobi{-1}{p}=1$ pretože $(-1)^\frac{p-1}{2}$.)

To isté môžeme zistiť modulo $q$.
Skombinovaním jednotilivých riešení modulo prvočísla dostaneme 4 riešenia
modulo $n$.\fixme{co ak su korene rovnake?}
\fixme{a co teraz, zacina tu byt bordel}



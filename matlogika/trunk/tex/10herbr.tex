\section{Herbrandova veta}

\begin{lema}[Dirichletov princíp]
    Nech $X,Y$ sú konečné množiny. Ak platí
    $|X| > |Y|$, potom pre každé zobrazenie
    $F:X \mapsto Y$ platí
    \begin{equation*}
        \exists y \in Y:
            \exists x_1,x_2 \in X:
                x_1 \ne x_2 \land f(x_1)=y=f(x_2)
    \end{equation*}
    Tvrdenie možno rozšíriť aj na prípad, že $X$ je nekonečná.
    Vtedy platí
    \begin{equation*}
        \exists y\in Y:
            \textit{množina }\{ x\in X: f(x)=y \}
            \textit{ je nekonečná}
    \end{equation*}
\end{lema}
\begin{dokaz}
    Dôkaz sa robí sporom. V prvom prípade dostaneme, že ak tvrdenie
    neplatí, $f$ by mala byť injektívna, čo je ale spor s
    mohutnosťami. V druhom prípade $X$ vieme rozložiť na niekoľko
    tried ekvivalencie podľa hodnoty $f(x)$ a nutne aspoň jedna z nich
    musí byť nekonečná.
\end{dokaz}

\begin{definicia}[usporiadanie stromu]
    Náš sémantický strom budeme chápať ako usporiadanú dvojicu 
    $(T,\le)$ kde $T$ je množina vrcholov a $\le$ je relácia,
    ktorá čiastočne usporadúva $T$.
    Požadujeme, aby platilo

    \begin{enumerate}
	\item $T(u)=\{v\in T, v<u\}$ je dobre usporiadaná 
            (každá jej neprázdna podmnožina má najmenší prvok).

	\item $T$ má najmenší vrchol (koreň)
    \end{enumerate}

    Ak máme prvky $u$ a $v$, hovoríme, že prvok $v$ nasleduje
    bezprostredne po prvku $u$, ak neexistuje $z$ také, že $u < z < v$.
\end{definicia}

\begin{lema}[K\"onig] 
    Nech každý vrchol stromu s koreňom má konečné vetvenie
    (t.j. konečný stupeň vetvenia) a strom $T$ je nekonečný.
    Potom v ňom existuje nekonečne dlhá vetva.
\end{lema}

\begin{dokaz} 
    Uvažujme strom $(T_1,\leq)$ a vrchol $v \in T$.
    Označme množinu tých vrcholov, ktoré ležia pod $v$, teda
    $A_v = \{ u \in T | v <u \}$.
    Nech $v_1, v_2, \dots, v_n$ sú bezprostrední nasledovníci vrchola $v$ (obr.
    \ref{fig:nasledovnici}). 
    \begin{figure}[h]
        \centering\includegraphics{img/10/nasledovnici.1.mps}
        \caption{Nasledovníci $v$}
        \label{fig:nasledovnici}
    \end{figure}
    Potom platí
    \begin{equation*}
        A_v = A_{v_1} \cup A_{v_2} \cup \ldots \cup A_{v_n}
        \cup \{v_1, v_2, \ldots, v_n\}
    \end{equation*}
    Predpokladáme, že $A_v$ je nekonečná.
    Na základe dirichletovho princípu potom jedna z množín $A_{v_i}$
    musí byť nekonečná.

    Vybereme si $x_0$ ako koreň (najmenší vrchol stromu $T$). 
    $A_{x_0} = T \backslash \{x_0\}$ a teda $A_{x_0}$ je nekonečná.
    Teraz viem ale nájsť pre $x_0$ nasledovníka $x_1$, pre ktorý
    $A_{x_1}$ je nekonečné. A pre ten vieme nájsť nasledovníka $x_2$
    \dots
    Viem teda zostrojiť nekonečnú postupnosť nasledovníkov koreňa a
    teda v strome existuje nekonečne dlhá cesta z koreňa.
\end{dokaz}

Po krátkej príprave sa môžeme pustiť do hlavnej časti, ktorá nás
zaujíma. Budeme si formulovať Herbrandovu vetu, tradične v dvoch
variantoch.

\begin{veta}[Herbrandova 1]
    Množina klauzúl $S$ nie je splniteľná práve vtedy,
    keď ľubovoľnému úplnému sémantickému stromu pre množinu klauzúl
    $S$ zodpovedá konečný uzavretý sémantický strom,
    t.j. ľubovoľná vetva úplného stromu vedie do odmietajúceho vrchola.
\end{veta}

\begin{dokaz}
    \noindent
    \begin{itemize}
    \item[$\Rightarrow:$] Predpokladajme, že množina klauzúl $S$
        nie je splniteľná (nie je splniťeľná pre ľubovoľnú
        H-interpretáciu).
        Nech $T$ je úplný sémantický strom prislúchajúci množine $S$.
        Označme ako $I_V$ množina všetkých literálov
        pripísaných vetve $V$ stromu $T$.
        Potom $I_V$ možno chápať ako interpretáciu množiny klauzúl $S$.

        Predpokladajme, že $S$ je nesplniteľná
        (teda nesplniteľná v každej interpretácii).
        To znamená, že pre klauzulu $C$ existuje nejaká
        základná inštancia $C'$, ktorá je v interpretácii $I_V$ odmietnutá.

        Ešte potrebujeme zabezpečiť, aby strom bol konečný.
        To ale musí byť, lebo ak by existovala nekonečná vetva,
        bola by to interpretácia, ktorá by neodmietala niektorú zo 
        základných inštancií.

    \item[$\Leftarrow:$] Teraz predpokladáme,
        že k úplnému sémantickému stromu pre množinu klauzúl $S$
        existuje konečný uzavretý sémantický strom.
        Teda každá vetva stromu $T$ končí v zamietajúcom vrchole.
        Nuž ale potom evidentne musí byť $S$ odmietnutá v každej
        interpretácii a teda nie je splniteľná.
    \end{itemize}
\end{dokaz}

\begin{veta}[Herbrandova 2]
    Množina klauzúl $S$ nie je splniteľná $\iff$
    existuje konečná podmnožina $S'$ základných inštancií klauzúl z $S$,
    ktorá nie je splniteľná.
\end{veta}

\begin{dokaz}
    \noindent
    \begin{itemize}
    \item[$\Rightarrow:$] Predpokladajme, že množina klauzúl $S$
        nie je splniteľná. Na základe variantu 1 Herbrandovej vety
        platí, že ku každému úplnému sémantickému stromu $T$ pre
        množinu klauzúl $S$ existuje uzavretý konečný sémantický
        strom $T'$. Ak teraz zoberieme množinu základných inštancií
        klauzúl z $T'$, dostávame konečnú množinu $S' \subseteq S$,
        ktorá tiež nie je splniteľná.

    \item[$\Leftarrow:$] Predpoklajme, že existuje
        konečná množina $S'$ základných inštancií klauzúl $S$,
        ktorá nie je splniteľná.
        Vezmime si $I$ interpretáciu $S$.
        Nech $I'$ je ``zúženie'' interpretácie $I$ na $S'$.
        Z nesplniteľnosťi $S'$ vyplýva, že $I'$ odmieta $S'$.

        Interpretácia $I$ obsahuje $I'$, teda keď $I'$ odmieta $S'$,
        potom $I$ odmieta $S$ a teda $S$ je nesplniteľná.
    \end{itemize}
\end{dokaz}

\begin{priklad}
    Majme množinu klauzúl $S=\{P(x),\ \neg P(f(a))\}$.
    Chceme ukázať, že $S$ nie je splniteľná.
    Na základe 2. Herbrandovej vety stačí nájsť konečnú podmnožinu
    základných inštancií klauzúl, ktorá nie je splniteľná.
    Takáto množina je napríklad $S' = \{ P(f(a)),\ \neg P(f(a))\}$.
\end{priklad}

\begin{priklad}
    Majme množinu klauzúl $S=\{\neg P(x) \lor Q(f(x),x),\
        P(g(b)),\ \neg Q(y,z) \}$.
    Táto množina nie je splniteľná -- vezmime napríklad
    \begin{equation*}
        S' = \{ \neg P(g(b)) \lor Q(f(g(b)), g(b)),\ P(g(b)),\ 
                \neg Q(f(g(b)), g(b)) \}
    \end{equation*}
\end{priklad}

\begin{priklad}
    Uvažujme množinu klauzúl $S$:
    \begin{equation*}
    \begin{split}
        S = \big\{& \neg P(x,y,u) \lor \neg P(y,z,v) \lor 
                    \neg P(x,v,w) \lor P(u,z,w), \\
	         & \neg P(x,y,u) \lor \neg P(z,y,v) \lor
                    \neg P(u,z,w) \lor P(x,v,w), \\
	         & P(g(x,y),x,y), \\
                 & P(x,h(x,y),y), \\
                 & P(x,y,f(x,y), \\
                 & \neg P(k(v),x,k(x)) \\
                 & \big\}
    \end{split}
    \end{equation*}
    Chceme ukázať, že $S$ nie je splniteľná. Návod je napríklad
    takýto: Zostrojme si konečný uzavretý sémantický strom pre $S$
    a potom vypíšme základné inštancie klauzúl pripísaných jednotlivým
    \fixme{cestám} tohoto stromu.
    Možné riešenie je tak napríklad
    \begin{equation*}
    \begin{split}
        S' = \big\{& P(a,h(a,a),a), \\
                   & P(g(a,k(h(a,a))),a,k(h(a,a))),\\
                   & \neg P(k(h(a,a)),h(a,a),k(h(a,a))),\\
                   & \neg P(g(a,k(h(a,a))),a,k(h(a,a))) \lor
                    \neg P(a,h(a,a),a) \lor \\ & \phantom{\lor}
                    \neg P(g(a,k(h(a,a))),a,k(h(a,a))) \lor
                    P(k(h(a,a)),h(a,a),k(h(a,a))) \\
                &\big\}
    \end{split}
    \end{equation*}
\end{priklad}

\begin{poznamka}[Gilmore, 1960]
    Nech $S_1',S_2',\dots$ sú možiny základných inštancií klauzúl z
    $S$. Gilmore vymyslel spôsob, ako generovať postupne
    $S_1',S_2',\dots$ a aj spôsob, ako overovať ich nesplniteľnosť.
    Problém bol, že algoritmické metódy na zisťovanie nesplniteľnosti
    pracovali iba pre menšie množiny klauzúl.
    $S_i'$ bola totiž konjunkcia základných inštancií klauzúl z $S$.
    Lenže $S$ je množina disjunkcií a dostaneme teda
    konjunktívnu normálnu formu. Túto formu bolo treba upraviť na
    disjunktívnu normálnu formu, pretože potom sa mohla optimalizovať
    metódami výrokovej logiky. Následne metóda vyhadzovala z DNF
    kontrárne dvojice.
    Pre veľa klauzúl krátkej dĺžky to znamenalo preberanie veľkého
    počtu možností.
    Ak máme $10$ klauzúl každá dĺžky 2 literály,
    potrebujeme preverovať $2^{10}$ prípadov -- zložitosť exponenciálne
    rastie.
\end{poznamka}

\begin{priklad}
    Majme množinu klauzúl $S=\{P(x),\ \neg P(a)\}$ a
    univerzum nech je $H_0 = \{a\}$.
    Ak zoberieme $S'=\{P(a), \neg P(a)\}$,
    máme $S_0' = P(a) \land \neg P(a)$, čo sa dá upraviť na $\eps$ a
    teda $S$ nie je splniteľná.
\end{priklad}


\begin{priklad}
    Majme $S=\{P(a),\ \neg P(x) \lor Q(f(x)),\ \neg Q(f(a)) \}$ a
    univerzum $H_0 = \{a\}$.
    Dokázať nesplniteľnost množiny $S$ možno nasledovne:
    \begin{equation*}
    \begin{split}
        S_0' &=P(a)\land [\neg P(a)\lor Q(f(a))] \land \neg Q(f(a)) \\
             &=[P(a)\land \neg P(a) \land \neg Q(f(a))] \lor 
               [P(a) \land Q(f(a)) \land \neg Q(f(a))] \\
             &= \eps \lor \eps = \eps
    \end{split}
    \end{equation*}
\end{priklad}

\subsection{Dokazovacie pravidlá}

Zaviedli ich Martin Davis a Hilary Putnam ako súčasť ich algoritmu na
automatické dokazovanie formúl. Z pravidiel ktoré si uvedieme bude
najsilnejšie takzvané pravidlo rezu, pomocou ktorého sa dajú simulovať
aj ostatné pravidlá.

\subsubsection{Pravidlo tautológie} 
Nech $S$ je množina klauzúl
Vynechajme z $S$ všetky tautologické klauzuly.
Množina $S'$, ktorá nám zostane, nie je splniteľná práve vtedy,
keď $S$ nie je splniteľná.

\subsubsection{Pravidlo jednoliterálnych klauzúl}
Nech $S$ je množina klauzúl $L$ je nejaká jednoliterálová klauzula.
Vynechajme z $S$ všetky klauzuly, ktoré obsahujú literál $L$.
Nech $S'$ sú klauzuly, ktoré nám zostanú po vynechaní.
Môžu nastať dva prípady:
\begin{enumerate}
    \item $S' = \emptyset$. Potom množina klauzúl $S$ je splniteľná --
        stačí zobrať model, ktorý obsahuje $L$.

    \item $S' \neq \emptyset$. Vezmem si literál $\neg L$ a vynechám z
        množiny $S'$ všetky klauzuly, ktoré obsahujú $\neg L$
        Dostanem tak množinu klauzúl $S''$.
        Ak sa $S'$ nachádza $\neg L$, po vynechaní
        $\neg L$ dostaneme $\eps$.
        Tvrdíme teda, že $S''$ nie je splniteľná
        $\iff$ $S$ nie je splniteľná.
        \fixme{preco?}
\end{enumerate}

\startFIXME

\subsubsection{Pravidlo čistých literálov}
Literál $L$ základnej klauzuly z $S$ budeme nazývať \emph{čistým},
ak literál $\neg L$ sa nevyskytuje v žiadnej základnej klauzule $S$.
Vezmem si z $S$ literál $L$, ktorý je čistý, a
vynecháme z $S$ všetky základne klauzuly obsahujúce $L$.
$S'$ je množina, ktorá nám zostala.
$S$ nie je splniteľná $\iff$ $S'$ nie je splniteľná.

\subaubsection{Pravidlo rezu}
Ak množinu $S$ vieme vyjadriť v tvare
$(A_1 \lor L) \land \ldots \land (A_m \lor L) \land 
 (B_1 \lor \neg L) \land \ldots \land (B_n \lor \neg L) \land R$,
pričom v $A_i$, $B_j$, sa $R$, $L$, $\neg L$, $i=1..m$,
$j=1..n$ už nevyskytujú.

$$S_1 = A_1 \land A_2 \land \ldots \land A_m \land R$$
$$S_2 = B_1 \land B_2 \land \ldots \land _n \land R$$

$S$ nie je splniteľná $\iff$ $S_1 \lor S_2$ nie je splniteteľná.

\paragraph{Dôkaz}
\begin{enumerate}
	\item Keď $S$ nie je splniteľné, tak ani $S_2$ nie je splniteľné --
	tautológie sú splnené pre ľubovoľné interpretácie. To, čo zostane,
	hovorí, či množina je alebo nie je splniteľná.
	\item Zostáva nám $S'$, ktoré vzniklo vynechaním $L$ z $S$. Ak
	$S'=\emptyset$, každá klauzula z $S$ obsahuje $L$ (je tvaru $L \lor
	\square$), stačí nám ohodnotenie, kedy $L$ je pravdivé, čo zabezpečí
	pravdivosť celého výroku. 
	\par
	Keď $S'$ nie je prázdna, vytvoríme $S''$ tak,
	že vynecháme všetky klauzuly obsahujúce $\neg L$. $S'$ nie je splniteľná
	práve vtedy, keď $S$ nie je splniteľná. Predpokladajme, že $S''$ nie je
	splniteľná a $S$ je splniteľná. Model $\mathcal{M}$ musí obsahovať $L$ a
	$S$ platí na $S''$.
	\todo{???}
	V konjunktívnej normálnej forme musia byť platné doplnky $\neg L \lor
	\square$. Potom $S''$ je splniteľná, čo je spor.

	\par Obrátene, nech $S$ nie je splniteľná. Z toho vyplýva, že $S''$ nie
	je splniteľná. Nech $S''$ je splniteľná. Potom existuje model
	$\mathcal{M}''$ pre $S''$. Ak tomuto modelu pridám $L$, potom
	$\mathcal{M}'' \cup L$ je model pre $S$, čo je spor.

	\item Pravidlo čistých literálov -- Máme čistý literál $L$, všetky
	klauzuly, ktoré ho obsahujú, vyhodíme z $S$ a dostaneme $S'$. $S$ nie je
	splniteľná práve vtedy, keď $S'$ nie je splniteľná. Predpokladajme, že
	$S'$ nie je splniteľná, teda pre žiadnu interpretáciu $I'$ neplatí. $S\
	\subseteq S$. Musí platiť, že $I' \subseteq I$.

	\par Obrátene -- predpokladajme, že $S$ nie je splniteľná. Potom aj $S'$
	nie je splniteľná. Predpokladajme, že $S'$ je splniteľná. Potom musí mať
	model $\mathcal{M}'$, ktorý jej vyhovuje. Keď si vytvorím model
	$\mathcal{M}=\mathcal{M}'\cup L$, potom $\mathcal{M}$ je modelom v $S$.

	\item Pravidlo rezu. Mám množinu $S$, popísaným spôsobom som zostrojil
	$S_1$ a $S_2$. Chceme ukázať, že $S$ nie je splniteľná $\iff$ $S_1 \lor
	S_2$. Predpokladajme, že $S$ je splniteľná. Potom $S_1 \lor S_2$ je
	splniteľná, teda aspoň jeden člen disjunkcie je splniteľný. Keď pridám
	modelu $S_1$ negované $B$, dostávam model pre $S$. Taktiež, keď je
	splnená $S_2$, má nejaký model $\mathcal{M_2}$. Keď k nemu pridám $B$,
	dostávam model pre $S$.

	\par Obrátene, predpokladajme, že $S_1$ alebo $S_2$ nie je splniteľná. Z
	toho vyplýva, že $S$ nie je splniteľná. Pre spor predpokladajme, že $S$
	je splniteľná. Pozrime sa, ako vyzerá $S$ -- všetky konjunktívne členy
	musia byť splnené a teda buď platí $\neg L$ alebo $L$. Vždy dospievam do
	sporu.
\end{enumerate}

\paragraph{Záver} Najvšeobecnejšie je pravidlo rezu, ktoré pokrýva aj všetky
ostatné prípady.

\paragraph{Príklad} Majmne množinu $S=(P \lor Q \lor \neg R) \land (P \lor \neg
Q) \land \neg P \land R \land U$. Ukážte, že množina klauzúl nie je splniteľná.
Použijeme pravidlo 2 s $\neg P$. Dostávam $Q\land\neg R) \land \neg  \land R
\land U$. Na túto množinu klauzúl použijem pravidlo 2 s $\neg Q$. Dostávam $\neg
R \land R \land U$, čo je $\square \land U \square$.




\paragraph{Príklad} (7) $S=(P \lor Q) \land \neg Q \land ( \neg P \lor Q \lor \neg
R)$. Ukážte, že množina klauzúl $S$ je splniteľná.
\par Pravidlo 2 s $\neg Q$: $(P \lor Q) \land ( \neg P \lor Q \lor \neg R)$ \\
$P \land (\neg P \lor \neg R)$ \\
$(P \land \neg P) \lor (P \land \neg R)$ (distributívnosť) \\
$P \land \neg L, I=\{P,\neg Q, \neg R\}$

\paragraph{Príklad} (8) $S=(P\lor \neg Q) \land (\neg P \lor Q) \land (Q \lor
\neg R) \land (\neg Q \lor \neg R)$. Zistite, či množina je alebo nie je
splniteľná.
\par vytvoríme si mnonžiny podľa pravidla 4: \\
$$(P\land \neg Q) \land (Q \lor \neg R)  \land (\neg Q \lor \neg R)$$
$$(\neg P \lor Q) \land (Q \lor \neg R) \land (\neg Q \lor \neg R)$$

\par
$$S_1 = \neg Q \land (Q \lor \neg R) \land (\neg Q \lor \neg R)$$
$$S_2 = Q \land (Q \lor \neg R) \land (\neg Q \lor \neg R)$$

($S_1$ a $S_2$ sú množiny rezu)
Na množiny môžem použiť pravidlo 2 -- s $Q$ a $\neg Q$. Dostávam $\neg R \lor
R$, čo je splniteľná klauzula.

\paragraph{Príklad} (9) $S=(P \lor Q) \land (P \lor \neg Q) \land (R \lor Q)
\land (R \lor \neg Q)$. $P$ je čistý literál; použijeme pravidlo 3:
$S': (R \lor Q) \land (R \lor \neg Q)$. \\
$\fbox{P,R}$ \\

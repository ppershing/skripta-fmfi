\section{Eliptické krivky}

Tento často počuteľný výraz znie veľmi matematicky. Napriek tomu si
ukážeme, že je to pomerne jednoduchý spôsob, ako generovať istý týp
grúp, v ktorých budeme vedieť následne počítať známe kryptografické
konštrukcie.

\begin{poznamka}
    Osobný názor doc. Staneka je, že eliptické krivky nahradia do
    niekoľko rokov RSA. Napríklad odporúčania na šifrovanie vládnych
    dokumentov v USA sa už ani nezmieňujú o používaní RSA. Nevýhodou
    RSA je totiž veľmi dlhý modulus pri ekvivalentnej bezpečnosti.
    Môžeme teda povedať, že diskrétny logaritmus začne vládnuť svetu
    :-)
\end{poznamka}

Ešte predtým, ako si povieme, čo to vlastne tieto krivky sú, uvedieme
si najväčšiu výhodu -- pre sofistikované algoritmy na
výpočet diskrétneho algoritmu ako napríklad general number field
sieve, index calculus nepoznáme v súčasnosti úpravy, ktoré by umožnili
ich aplikáciu na eliptické krivky. Dajú sa teda použiť iba generické
algoritmy. Tým pádom môžeme používať menšie kľúče, budeme mať menšie
podpisy, ... Hneď ale pripojíme aj varovanie -- existujú špecifické
útoky na isté typy eliptických kriviek, preto je potrebné venovať
generovaniu krivky dostatočnú pozornosť.

\begin{definicia}[Eliptická krivka]
    Pod eliptickou krivkou nad poľom $F$ budeme označovať množinu
    všetkých takých bodov, ktoré vyhovujú rovnici
    \begin{equation*}
        x^3 + A x + B = y^2
    \end{equation*}
    kde $A,B$ sú vopred zvolené konštanty.
    Pre body $(x,y)$ si zavedieme grupovú operáciu sčítania ``+''
    a neutrálny prvok $0$, ktorý bude predstavovať bod v nekonečne.
\end{definicia}

Ak si zoberieme pole $F=R$, eliptická krivka $x^3 -3x+3=y^2$ je
zobrazená na obrázku \ref{fig:elliptic1}

\begin{figure}[h]
    \centering
    \includegraphics{img/09/elliptic.1.mps}
    \caption{Eliptická krivka $x^3 - 3x +3 = y^2$ v reálnych číslach}
    \label{fig:elliptic1}
\end{figure}

Ešte predtým, ako si ukážeme sčítanie bodov, ktoré nie je úplne
triviálne, budeme sa zaoberať podmienkou na to, aby daná krivka bola
regulárna.

Predstavme si, že krivka je singulárna, t.j. existuje dvojitý koreň,
označme ho $a$ a označme tretí koreň $b$ (neplatí nutne $a\ne b$).
Dostávame
\begin{align*}
    (x-a)^2 (x-b) &= x^3 + Ax + B \\
    x^3 + x^2 (-b -2a) + x (2ab + a^2) + (-b a^2) &= x^3 + Ax + B
\end{align*}
Z koeficientu pred $x^2$ dostávame $b=-2a$ a teda
\begin{align*}
    A &= 2ab + a^2 = -3 a^2 \\
    B &= -b a^2 = 2 a^3
\end{align*}
Čo nastáva v prípade, ak
\begin{equation*}
    4 A^3 + 27 B^2 = 0
\end{equation*}
Pri generovaní kriviek budeme teda musieť otestovať túto rovnice a v
prípade rovnosti generovať novú krivku.

Poďme ale späť k sčítavaniu
\begin{definicia}[Sčítanie bodov eliptickej krivky]
    Majme body $P=[x_1,y_1]$ a $Q=[x_2,y_2]$.\footnote{Body
        eliptických kriviek zvykneme označovať veľkými písmenami}
    Nech $P \ne -Q$, kde znamienkom ``-'' budeme označovať
    bod $(x,-y)$ (Prípad $P = -Q$ definujeme ako $P+Q=0$).
    Potom operáciu sčítania $P+Q$ definujeme nasledovne:

    \begin{equation*}
        P+Q = [ \underbrace{\lambda^2 - x_1 - x_2}_{x_3}, \ 
            \lambda (x_1 - x_3) - y_1]
    \end{equation*}
    kde $\lambda$ je definované ako
    \begin{equation*}
        \lambda =
            \begin{cases}
                (y_2 -y_1)(x_2 - x_1)^{-1} \quad & P \ne Q \\
                (3 x_1^2 + A)(2 y_1)^{-1} \quad & P = Q
            \end{cases}
    \end{equation*}
\end{definicia}

Budeme tvrdiť, že množina bodov $\{(x,y)\} \union 0$
eliptickej krivky spolu s operáciu ``+'' bude tvoriť grupu. Toto
netriviálne algebraické tvrdenie prenecháme na neveriaceho
čitateľa. Ak teda zoberieme ako $F$ nejaké konečné
pole, dostávame konečnú grupu.

Predchádzajúca definícia sčítania možno nebola veľmi intuitívna.
Ukážeme si teda iný prístup k definícii sčítania bodov na eliptickej
krivke. Spôsob je to čisto grafický.
Ak máme body $P,Q$, body $-P, 2P, P+Q$ získame postupne ako
zrkadlenie bodu $P$ podľa osi $x$,
zkradlenie priesečníka dotyčnice v bode $P$ s krivkou
a zkradlenie tretieho priesečníka priamky prechádzajúcej bodmi $P,Q$ a
eliptickej krivky. Názorne to možno vidieť na obrázku
$\ref{fig:elliptic-plus}$.

\begin{figure}
    \centering
    \subfigure[$-P$]{
        \includegraphics{img/09/elliptic.2.mps}
    }
    \subfigure[$2P$]{
        \includegraphics{img/09/elliptic.3.mps}
    }
    \subfigure[$P+Q$]{
        \includegraphics{img/09/elliptic.4.mps}
    }

    \caption{Grafické sčítanie na eliptických krivkách}
    \label{fig:elliptic-plus}
\end{figure}

\begin{priklad}
    Uvedieme si ilustratívny príklad eliptickej krivky. Uvažujme
    rovnicu
    \begin{equation*}
        y^2 = x^3 + x + 1 \pmod{11}
    \end{equation*}
    Vypočítajme body vyhovujúce krivke:

    \begin{table}[h!]
        \centering
        \begin{tabular}{c|c|c}
            $x$ & $x^3 + x + 1 \pmod{11}$ & $y$ \\
            \hline 0 & 1 & 1, 10 \\
            \hline 1 & 3 & 5, 6 \\
            \hline 2 & 0 & 0 \\
            \hline 3 & 9 & 3, 8 \\
            \hline 4 & 3 & 5, 6 \\
            \hline 5 & 4 & 2, 9 \\
            \hline 6 & 3 & 5, 6 \\
            \hline 7 & 10 & - \\
            \hline 8 & 4 & 2, 9 \\
            \hline 9 & 2 & - \\
            \hline 19 & 10 & - \\
        \end{tabular}
        \caption{Body ležiace na eliptickej krivke $x^3 + x + 1
        \pmod{11}$}
    \end{table}
    Dostávame teda, že množina bodov našej krivky je
    \begin{equation*}
       E=\Big\{ [0,1], [0,10], [1,5], [1,6],
                [2,0], [3,3], [3,8],
                [4,5], [4,6], [5,2], [5,9],
                [6,5], [6,6], [9,2], [9,9], 0 \Big\}
    \end{equation*}
    Príklad niektorých sčítaní:
    \begin{align*}
        [2,0] + [2,0] &= 0 \\
        [1,5] + [1,6] &= 0 \\
        [0,1] + [3,3] &= [6, 6] 
    \end{align*}
\end{priklad}

Dostali sme sa do stavu, že máme grupu bodov eliptickej krivky. Toto
samo o sebe je síce pekné, ale na naše účely to nestačí. To, čo by sme
momentálne potrebovali vedieť je, že aká veľká daná grupa je (koľko má
prvkov) a či obsahuje malé podgrupy.

Druhá vlastnosť nás nezaujíma len tak zo zvedavosti -- Pohlig Hellmanov
algoritmus, ktorý dobre poznáme by v tomto prípade narobil paseku a
bezpečnosť schémy by bola ohrozená. Preto by sme boli najradšej, ak by
sme mali prvočíselnú grupu. Začneme však postupne:

\begin{veta}[\fixme{nazov}]
    Nech $E$ je grupa bodov eliptickej krivky $\pmod{p}$.
    Potom platí
    \begin{equation*}
        P+1 - 2 \sqrt{P} \le |E| \le P + 1 + 2 \sqrt{P}
    \end{equation*}
\end{veta}

Dá sa teda garantovať, že počet bodov eliptickej krivky je dostatočne
veľký, no o veľkých prvočíselných faktoroch nám to nič nepovie.
Na pomoc príde \fixme{meno} Schufov algoritmus, ktorý v čase
$O((\log{p})^6)$ vie presne určiť počet bodov krivky. Problém je však
v tom, že na praktické účely je aj toto priveľa -- v roku 2001 vraj
výpočet pre 200 bitové čísla trval niekoľho hodín. Teda, v súčasnosti
nie je efektívne počítať veľkosť grupy tvojenej bodmi eliptickej
krivky, minimálne nie na takej úrovni ako sa používa RSA napríklad pri
zabezpečovaní secure http.

Ako teda, že sa eliptické krivky používajú v praxi? Odpoveď je
jednoduchá -- niekto si dal záležať a našiel takú grupu, že $|E|$ je
prvočíslo. Napríklad, v štandarde DSS (Digital Signature standard), v
časti o ECDSA (Elliptic Curve DSA) sa explicitne uvádzajú krivky,
ktoré sa majú používať. Tieto krivky majú napevno zvolené $A=-3$ a $B$
bolo volené tak, aby $|E|$ bolo prvočíslo -- napríklad tak, že sa
postupne preberali možné parametre $B$ a $p$.

\begin{poznamka}[Pre fanúšikov algebry]
    Dá sa ukázať, že grupa $(E,+)$ je izomorfná so
    $Z_{n_1} \times Z_{n_2}$, kde $n_2$ delí $n_1$, $n_2$ delí $p-1$ a
    $n_1,n_2$ sú jednoznačne určené.
    Navyše, vhodnou voľbou parametrov sa dá dosiahnuť, že
    $n_2=1$, t.j. dostávame izomorfizmus so $Z_p^*$. Prirodzenou
    otázkou v takomto prípade je, či izomorfizmus nezmenšuje
    bezpečnosť -- mohli by sa dať aplikovať klasické algoritmy na
    faktorizáciu aj na eliptické krivky. \fixme{ako to vlastne je?}
\end{poznamka}

Teraz si predstavíme algoritmus ECDSA určený na digitálne podpisovanie
správ.

Začneme parametrami, ktoré sa zvyknú uvádzať v tabuľkách eliptických
kriviek:
\begin{itemize}
    \item $A$
    \item $B$
    \item $p$ -- prvočíselný modulus
    \item $FR$ -- field representation -- buď ako polynómy nad
        $GF(2^m)$ (binárne polia)
        alebo ako mocniny generátora (prvočíselné polia)
        alebo Koblitzove krivky.
    \item $seed$ -- keď niekto neverí vygenerovaným krivkám, môže si
        overiť, že boli vygenerované podľa tohoto seedu.
    \item $G$ -- generátor prvočíselnej podgrupy, je to bod patriaci krivke
    \item $n$ -- rád $G$ (generátora podgrupy)
    \item $k$ -- kofaktor, $k=|E| / n$
\end{itemize}
\begin{poznamka}
    V štandarde sa používajú krivky s kofaktorom $k=1,2,4$, teda (ako
    sa ukáže), dĺžka verejného a privátneho kľúča je približne
    rovnaká.
\end{poznamka}

Čo sa týka prvočíselného modula $p$, štandard prechádza plejádou
hodnôt od 192 po 521 bitov. \fixme{nie 512?}
Príklady:
\begin{itemize}
    \item $2^{192} - 2^{64} - 1$ 
    \item $2^{384} ?? 2^{126} ...$ \fixme{}
    \item $2^{521} - 1$.
\end{itemize}
Vo všeobecnosti sa volia takmer mersenovské prvočísla.

Ale vráťme sa k samotnému podpisovaniu. Prvou častou je generovanie
kľúčov:
\begin{procedure}
    \caption{GenECDSA()}
    \label{proc:genecdsa}
    $sk = d \inr \{1, \dots, n-1\}$ \;
    $pk = Q = d*G = \underbrace{G+G+G+\dots+G}_{d \times}$ \;
\end{procedure}

\todo{zvyšok ECDSA}

\todo{ElGamal v eliptickych}

\todo{zvysok co Stanek rozpraval a nemam v poznamkach}
